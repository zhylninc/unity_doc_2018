<html><head><title>html模版</title></head><body>Unity - Manual: Spatial Mapping best practices</br>
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2018.1 beta)</a></li>
<li><a href="PlatformSpecific.html">Platform-specific</a></li>
<li><a href="Windows.html">Windows</a></li>
<li><a href="windowsholographic.html">Windows Holographic</a></li>
<li><a href="windowsholographic-spatialmapping.html">Spatial Mapping</a></li>
<li>Spatial Mapping best practices</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="windowsholographic-sm-lowlevelapi.html"></a></span><div class="tip">Spatial Mapping basic low level API usage</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="windowsholographic-sm-component.html"></a></span><div class="tip"> Spatial Mapping components</div>
</div>
</div></div>
<div class="otherversionswrapper" onmouseover="setOtherVersionsDisplay(true)" onmouseout="setOtherVersionsDisplay(false)">
<a>Other Versions</a><div class="otherversionscontent" id="OtherVersionsContent" style="display: none;">Cannot access other versions offline!</div>
</div>
<div class="scrollToFeedback"><a id="scrollToFeedback">Leave feedback</a></div>
<h1>Spatial Mapping best practices</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Because of the volume of data that can be generated by Spatial Mapping, and the effect on speed and performance of generating that data, there are many issues to consider when using the low-level API. </p>

<p>If you don’t carefully plan your application’s use of Spatial Mapping, your application’s speed and performance can be poor. Below are some potential issues that Spatial Mapping can create, and best practice advice on how to work around them.</p>

<h2>Issue: Generating collision data is very slow</h2>

<p>Generating collision data uses most of the CPU computation when generating Spatial Mapping data. Requesting collision data that isn’t going to be used unnecessarily ties up CPU resources and reduces battery life.</p>

<h3>Best practice solution:</h3>

<ul>
<li>Request collision data only where necessary. Avoiding collision data requests when they are not needed decreases the latency for other Spatial Mapping requests, and prolongs battery life.</li>
<li>Request only those <strong>Surfaces</strong> that are most important. Use a <strong>Surface</strong>’s update time and bounding boxes to prioritize data requests.</li>
</ul>

<h2>Issue: High triangle densities generate a lot of geometry</h2>

<p>You can specify high values of <strong>trianglesPerCubicMeter</strong> in the <a href="../ScriptReference/XR.WSA.SurfaceData.html">SurfaceData struct</a> when requesting <strong>Surface</strong> data through <a href="../ScriptReference/XR.WSA.SurfaceObserver.RequestMeshAsync.html">RequestMeshAsync</a>. This generates a very large amount of geometry, especially in spaces with a lot of objects such as a cluttered office. Large amounts of geometry increase data generation latency and memory usage. In addition, higher Mesh densities can make run-time systems such as rendering and physics run more slowly.</p>

<h3>Best practice solution:</h3>

<ul>
<li>Ask for the minimum resolution of Spatial Mapping data required. Asking for lower resolutions of generated Meshes results in less CPU time spent serving requests. This reduces power consumption, increases battery life, and reduces the latency of Mesh data delivery. Lower resolution Meshes also have fewer negative effects on run-time performance and are less resource-intensive on memory requirements. This is especially true for the physics runtime, which expects low complexity geometry.</li>
</ul>

<h2>Issue: Queuing too many mesh requests result in doing unnecessary work</h2>

<p>
<a href="../ScriptReference/XR.WSA.SurfaceObserver.html">SurfaceObservers</a> report all added, updated, and removed <strong>Surfaces</strong> within their volume when <a href="../ScriptReference/XR.WSA.SurfaceObserver.Update.html">Update</a> is called. </p>

<p>Adding the total list of changed <strong>Surfaces</strong> to the work queue can result in <strong>Surfaces</strong> remaining in the work queue after they have been removed by the system. <strong>Surfaces</strong> still in the work queue after they have been removed still take up CPU time moving through the system, but do not generate any mMsh data. This increases the latency of any waiting requests.</p>

<h3>Best practice solution:</h3>

<ul>
<li>Limit the number of <strong>Surfaces</strong> in the work queue when possible. Given the long latencies associated with the Mesh work queue, keep only a single <code>RequestMeshAsync</code> in use at a time. Applications can use a <strong>Surface</strong>’s reported update time and bounds to prioritize <code>RequestMeshAsync</code> calls.</li>
<li>Prioritize <strong>Surface</strong> data requests so that your application gets the most important data first. Examples of this include:

<ul>
<li>Prioritize new <strong>Surfaces</strong> over updates to existing ones.</li>
<li>Prioritize near <strong>Surfaces</strong> over more distant ones.</li>
</ul>
</li>
</ul>

<h2>Issue: Overlapping or adjacent SurfaceObservers report the same Mesh, resulting in duplicate RequestMeshAsync calls</h2>

<p>Each <a href="../ScriptReference/XR.WSA.SurfaceObserver.html">SurfaceObserver</a> reports changes for all <strong>Surfaces</strong> that overlap its volume. A <strong>Surface</strong> can overlap multiple <strong>SurfaceObserver</strong> volumes if those volumes are close, so your application code might request the same <strong>Surfaces</strong> multiple times.</p>

<h3>Best practice solution:</h3>

<ul>
<li>Use a single work submit queue across all <a href="../ScriptReference/XR.WSA.SurfaceObserver.html">SurfaceObservers</a>.
Often, a single <strong>SurfaceObserver</strong> is enough, as using just one avoids application complexity.
However, there are several advanced use cases for <strong>Spatial Mapping</strong> that require multiple <strong>SurfaceObservers</strong>. In these cases, use a single queue across all <strong>SurfaceObservers</strong> to uniquely prioritize Mesh requests.</li>
<li>Use a single <strong>SurfaceObserver</strong> if your application does not require more complexity.</li>
</ul>

<h2>Issue: Updating a SurfaceObserver generates no onSurfaceChanged callbacks</h2>

<p>This common issue is typically due to one or more set-up issues.</p>

<h3>Best practice solution:</h3>

<ul>
<li>Ensure that you set a valid volume on your <strong>SurfaceObserver</strong> through a function like <a href="../ScriptReference/XR.WSA.SurfaceObserver.SetVolumeAsAxisAlignedBox.html">SetVolumeAsAxisAlignedBox</a>.</li>
<li>Ensure that you’ve checked <strong>Spatial Perception</strong> from the <strong>Publishing Settings</strong> section of <strong>Player Settings</strong>.</li>
</ul>
<div class="feedbackbox" id="feedbackbox">
<div id="rating"><p>Did you find this page useful? Please give it a rating:<br><div id="ratecontent" class="c-rating"></div>
</p></div>
<div id="ratingThanks" style="display:none"><p>Thanks for rating this page!</p></div>
<div id="problem"><p><a name="problem" onclick="document.getElementById('problemType').style.display = '';document.getElementById('problem').style.display = 'none';">Report a problem on this page</a></p></div>
<div id="problemType" style="display:none"><p>What kind of problem would you like to report?<ul type="problems">
<li><a name="needcode" onclick="                                                             document.getElementById('problemType').style.display = 'none';                                                             document.getElementById('problemThanks').style.display = '';                                                             SendFeedback('problem-needcode',window.location.href,0);                                                             document.getElementById('problemFormDescription').value='Needs code samples.';                                                             document.getElementById('problemNeedCodeForm').style.display = ''                                                         ">This page needs code samples</a></li>
<li><a name="code" onclick="document.getElementById('problemType').style.display = 'none';                                                         document.getElementById('problemThanks').style.display = '';                                                         SendFeedback('problem-brokencode',window.location.href,0);                                                         document.getElementById('problemFormDescription').value='Code samples do not work.';                                                         document.getElementById('problemCodeForm').style.display = ''                                                         ">Code samples do not work</a></li>
<li><a name="missing" onclick="document.getElementById('problemType').style.display = 'none';                                                         document.getElementById('problemThanks').style.display = '';                                                         SendFeedback('problem-missing',window.location.href,0);                                                         document.getElementById('problemFormDescription').value='Missing information';                                                         document.getElementById('problemMissingForm').style.display = ''                                                         ">Information is missing</a></li>
<li><a name="incorrect" onclick="document.getElementById('problemType').style.display = 'none';                                                         document.getElementById('problemThanks').style.display = '';                                                         SendFeedback('problem-incorrect',window.location.href,0);                                                         document.getElementById('problemFormDescription').value='Incorrect information';                                                         document.getElementById('problemIncorrectForm').style.display = ''                                                         ">Information is incorrect</a></li>
<li><a name="unclear" onclick="document.getElementById('problemType').style.display = 'none';                                                         document.getElementById('problemThanks').style.display = '';                                                         SendFeedback('problem-unclear',window.location.href,0);                                                         document.getElementById('problemFormDescription').value='Unclear or confusing information';                                                         document.getElementById('problemUnclearForm').style.display = ''                                                         ">Information is unclear or confusing</a></li>
<li><a name="language" onclick="document.getElementById('problemType').style.display = 'none';                                                         document.getElementById('problemThanks').style.display = '';                                                         SendFeedback('problem-language',window.location.href,0);                                                         document.getElementById('problemFormDescription').value='Spelling or grammar error';                                                         document.getElementById('problemLanguageForm').style.display = ''                                                         ">There is a spelling/grammar error on this page</a></li>
<li><a name="other" onclick="document.getElementById('problemType').style.display = 'none';                                                         document.getElementById('problemThanks').style.display = '';                                                         SendFeedback('problem-other',window.location.href,0);                                                         document.getElementById('problemFormDescription').value='This page has a problem';                                                         document.getElementById('problemOtherForm').style.display = ''                                                         ">Something else</a></li>
</ul>
<p><known_issues><p>Is something described here not working as you expect it to? It might be a <b>Known Issue</b>. Please check with the Issue Tracker at <a href="https://issuetracker.unity3d.com">issuetracker.unity3d.com</a>.</p></known_issues></p>
</p></div>
<div id="problemThanks" style="display:none"><p>Thanks for letting us know! This page has been marked for review based on your feedback.<br><br>If you have time, you can provide more information to help us fix the problem faster.<br><br><a onclick="document.getElementById('problemMoreInfo').style.display = '';document.getElementById('problemThanks').style.display = 'none';">Provide more information</a><br>
</p></div>
<div id="problemMoreInfo" style="display:none">
<p id="problemNeedCodeForm" style="display:none">You've told us this page needs code samples. If you'd like to help us further, you could provide a code sample, or tell us about what kind of code sample you'd like to see:</p>
<p id="problemCodeForm" style="display:none">You've told us there are code samples on this page which don't work. If you know how to fix it, or have something better we could use instead, please let us know:</p>
<p id="problemMissingForm" style="display:none">You've told us there is information missing from this page. Please tell us more about what's missing:</p>
<p id="problemIncorrectForm" style="display:none">You've told us there is incorrect information on this page. If you know what we should change to make it correct, please tell us:</p>
<p id="problemUnclearForm" style="display:none">You've told us this page has unclear or confusing information. Please tell us more about what you found unclear or confusing, or let us know how we could make it clearer:</p>
<p id="problemLanguageForm" style="display:none">You've told us there is a spelling or grammar error on this page. Please tell us what's wrong:</p>
<p id="problemOtherForm" style="display:none">You've told us this page has a problem. Please tell us more about what's wrong:</p>
<form>
<textarea id="problemFormSuggestionField" cols="40" rows="5"></textarea><input type="hidden" id="problemFormDescription"><input type="submit" id="problemFormDescriptionSubmit" value="Submit" onclick="                                             document.getElementById('problemMoreInfo').style.display = 'none';                                             document.getElementById('problemMoreInfoThanks').style.display = '';                                             return false;                                             ">
</form>
</div>
<div id="problemMoreInfoThanks" style="display:none"><p>Thanks for helping to make the Unity documentation better!</p></div>
<script>

                                            var ratecontent = document.querySelector('#ratecontent'); // target element
                                            var currentRating = 0; // initial rating
                                            var maxRating= 5; // max rating

                                            // callback to run after setting the rating
                                            var callback = function(rating) {
                                                document.getElementById('ratingThanks').style.display = '';
                                                document.getElementById('ratecontent').style.display = 'none';
                                                document.getElementById('rating').style.display = 'none';
                                                SendFeedback("rating",window.location.href,rating);
                                            };

                                            // rating instance
                                            var myRating = rating(ratecontent, currentRating, maxRating, callback);
                                        </script>
</div>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="windowsholographic-sm-lowlevelapi.html"></a></span><div class="tip">Spatial Mapping basic low level API usage</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="windowsholographic-sm-component.html"></a></span><div class="tip"> Spatial Mapping components</div>
</div>
</div>
</div>
</body></html>